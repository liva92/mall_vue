{"remainingRequest":"C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\67564\\Desktop\\面试\\mall\\src\\views\\detail\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\67564\\Desktop\\面试\\mall\\src\\views\\detail\\Detail.vue","mtime":1577264735260},{"path":"C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576308382003},{"path":"C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576308382003},{"path":"C:\\Users\\67564\\Desktop\\面试\\mall\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _objectSpread from \"C:\\\\Users\\\\67564\\\\Desktop\\\\\\u9762\\u8BD5\\\\mall\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapActions } from 'vuex';\nimport Scroll from \"common/scroll/Scroll\";\nimport DetailNavBar from \"./childComps/DetailNavBar\";\nimport DetailSwiper from \"./childComps/DetailSwiper\";\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo\";\nimport DetailShopInfo from \"./childComps/DetailShopInfo\";\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo\";\nimport DetailParamInfo from \"./childComps/DetailParamInfo\";\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo\";\nimport DetailRecommendInfo from \"./childComps/DetailRecommendInfo\";\nimport DetailBottomBar from \"./childComps/DetailBottomBar\";\nimport BackTop from \"content/backTop/BackTop\";\nimport { getDetail, getRecommend, Goods, Shop, GoodsParam } from \"network/detail\";\nimport { backTopMixin } from \"@/common/mixin\";\nimport { BACKTOP_DISTANCE } from \"@/common/const\";\nexport default {\n  name: \"Detail\",\n  components: {\n    DetailBaseInfo: DetailBaseInfo,\n    DetailShopInfo: DetailShopInfo,\n    DetailGoodsInfo: DetailGoodsInfo,\n    DetailParamInfo: DetailParamInfo,\n    DetailCommentInfo: DetailCommentInfo,\n    DetailRecommendInfo: DetailRecommendInfo,\n    DetailBottomBar: DetailBottomBar,\n    Scroll: Scroll,\n    DetailNavBar: DetailNavBar,\n    DetailSwiper: DetailSwiper,\n    BackTop: BackTop\n  },\n  mixins: [backTopMixin],\n  data: function data() {\n    return {\n      iid: \"\",\n      topImages: [],\n      goods: {},\n      shop: {},\n      detailInfo: {},\n      paramInfo: {},\n      commentInfo: {},\n      recommendList: [],\n      themeTops: [],\n      currentIndex: 0\n    };\n  },\n  created: function created() {\n    this._getDetailData();\n\n    this._getRecommend();\n  },\n  updated: function updated() {\n    // 获取需要的四个offsetTop\n    this._getOffsetTops();\n  },\n  methods: _objectSpread({}, mapActions(['addCart']), {\n    _getOffsetTops: function _getOffsetTops() {\n      this.themeTops = [];\n      this.themeTops.push(this.$refs.base.$el.offsetTop);\n      this.themeTops.push(this.$refs.param.$el.offsetTop);\n      this.themeTops.push(this.$refs.comment.$el.offsetTop);\n      this.themeTops.push(this.$refs.recommend.$el.offsetTop);\n      this.themeTops.push(Number.MAX_VALUE);\n    },\n    contentScroll: function contentScroll(position) {\n      // 1.监听backTop的显示\n      this.showBackTop = position.y < -BACKTOP_DISTANCE; // 2.监听滚动到哪一个主题\n\n      this._listenScrollTheme(-position.y);\n    },\n    _listenScrollTheme: function _listenScrollTheme(position) {\n      var length = this.themeTops.length;\n\n      for (var i = 0; i < length; i++) {\n        var iPos = this.themeTops[i];\n        /**\r\n         * 判断的方案:\r\n         *  方案一:\r\n         *    条件: (i < (length-1) && currentPos >= iPos && currentPos < this.themeTops[i+1]) || (i === (length-1) && currentPos >= iPos),\r\n         *    优点: 不需要引入其他的内容, 通过逻辑解决\r\n         *    缺点: 判断条件过长, 并且不容易理解\r\n         *  方案二:\r\n         *    条件: 给themeTops最后添加一个很大的值, 用于和最后一个主题的top进行比较.\r\n         *    优点: 简洁明了, 便于理解\r\n         *    缺点: 需要引入一个较大的int数字\r\n         * 疑惑: 在第一个判断中, 为什么不能直接判断(currentPos >= iPos)即可?\r\n         * 解答: 比如在某一个currentPos大于第0个时, 就会break, 不会判断后面的i了.\r\n         */\n\n        if (position >= iPos && position < this.themeTops[i + 1]) {\n          if (this.currentIndex !== i) {\n            this.currentIndex = i;\n          }\n\n          break;\n        }\n      }\n    },\n    titleClick: function titleClick(index) {\n      console.log(this.themeTops[index]);\n      this.$refs.scroll.scrollTo(0, -this.themeTops[index], 100);\n    },\n    addToCart: function addToCart() {\n      var _this = this;\n\n      // 1.创建对象\n      var obj = {}; // 2.对象信息\n\n      obj.iid = this.iid;\n      obj.imgURL = this.topImages[0];\n      obj.title = this.goods.title;\n      obj.desc = this.goods.desc;\n      obj.newPrice = this.goods.nowPrice; // 3.1用mapAction映射添加到Store中\n\n      this.addCart(obj).then(function (res) {\n        _this.$toast.show(res);\n      }); //3.2用dispatc添加到Store中\n      // this.$store.dispatch(\"addCart\", obj).then(res=>{\n      //   console.log(res)\n      // });\n      //4.添加到购物车成功\n    },\n    _getDetailData: function _getDetailData() {\n      var _this2 = this;\n\n      // 1.获取iid\n      var iid = this.$route.query.iid;\n      this.iid = iid; // 2.请求数据\n\n      getDetail(iid).then(function (res) {\n        // 2.1.获取结果\n        var data = res.result; // 2.2.获取顶部信息\n\n        _this2.topImages = data.itemInfo.topImages; // 2.3.获取商品信息\n\n        _this2.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services); // 2.4.获取店铺信息\n\n        _this2.shop = new Shop(data.shopInfo); // 2.5.获取商品信息\n\n        _this2.detailInfo = data.detailInfo; // 2.6.保存参数信息\n\n        _this2.paramInfo = new GoodsParam(data.itemParams.info, data.itemParams.rule); // 2.7.保存评论信息\n\n        if (data.rate.list) {\n          _this2.commentInfo = data.rate.list[0];\n        }\n      });\n    },\n    _getRecommend: function _getRecommend() {\n      var _this3 = this;\n\n      getRecommend().then(function (res, error) {\n        if (error) return;\n        _this3.recommendList = res.data.list;\n      });\n    }\n  })\n};",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div id=\"detail\">\r\n    <detail-nav-bar @itemClick=\"titleClick\" :current-index=\"currentIndex\"></detail-nav-bar>\r\n    <scroll\r\n      class=\"content\"\r\n      ref=\"scroll\"\r\n      @scroll=\"contentScroll\"\r\n      :data=\"[topImages, goods, shop, detailInfo, paramInfo, commentInfo, recommendList]\"\r\n      :probe-type=\"3\"\r\n    >\r\n      <div>\r\n        <detail-swiper ref=\"base\" :images=\"topImages\"></detail-swiper>\r\n        <detail-base-info :goods=\"goods\"></detail-base-info>\r\n        <detail-shop-info :shop=\"shop\"></detail-shop-info>\r\n        <detail-goods-info :detail-info=\"detailInfo\"></detail-goods-info>\r\n        <detail-param-info ref=\"param\" :param-info=\"paramInfo\"></detail-param-info>\r\n        <detail-comment-info ref=\"comment\" :comment-info=\"commentInfo\"></detail-comment-info>\r\n        <detail-recommend-info ref=\"recommend\" :recommend-list=\"recommendList\"></detail-recommend-info>\r\n      </div>\r\n    </scroll>\r\n    <detail-bottom-bar @addToCart=\"addToCart\"></detail-bottom-bar>\r\n    <back-top @backTop=\"backTop\" class=\"back-top\" v-show=\"showBackTop\">\r\n      <img src=\"~assets/img/common/top.png\" alt />\r\n    </back-top>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {mapActions} from 'vuex'\r\nimport Scroll from \"common/scroll/Scroll\";\r\n\r\nimport DetailNavBar from \"./childComps/DetailNavBar\";\r\nimport DetailSwiper from \"./childComps/DetailSwiper\";\r\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo\";\r\nimport DetailShopInfo from \"./childComps/DetailShopInfo\";\r\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo\";\r\nimport DetailParamInfo from \"./childComps/DetailParamInfo\";\r\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo\";\r\nimport DetailRecommendInfo from \"./childComps/DetailRecommendInfo\";\r\n\r\nimport DetailBottomBar from \"./childComps/DetailBottomBar\";\r\nimport BackTop from \"content/backTop/BackTop\";\r\nimport {\r\n  getDetail,\r\n  getRecommend,\r\n  Goods,\r\n  Shop,\r\n  GoodsParam\r\n} from \"network/detail\";\r\nimport { backTopMixin } from \"@/common/mixin\";\r\nimport { BACKTOP_DISTANCE } from \"@/common/const\";\r\n\r\nexport default {\r\n  name: \"Detail\",\r\n  components: {\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetailCommentInfo,\r\n    DetailRecommendInfo,\r\n    DetailBottomBar,\r\n    Scroll,\r\n    DetailNavBar,\r\n    DetailSwiper,\r\n    BackTop\r\n  },\r\n  mixins: [backTopMixin],\r\n  data() {\r\n    return {\r\n      iid: \"\",\r\n      topImages: [],\r\n      goods: {},\r\n      shop: {},\r\n      detailInfo: {},\r\n      paramInfo: {},\r\n      commentInfo: {},\r\n      recommendList: [],\r\n      themeTops: [],\r\n      currentIndex: 0\r\n    };\r\n  },\r\n  created() {\r\n    this._getDetailData();\r\n    this._getRecommend();\r\n  },\r\n  updated() {\r\n    // 获取需要的四个offsetTop\r\n    this._getOffsetTops();\r\n  },\r\n  methods: {\r\n    ...mapActions(['addCart']),\r\n    _getOffsetTops() {\r\n      this.themeTops = [];\r\n      this.themeTops.push(this.$refs.base.$el.offsetTop);\r\n      this.themeTops.push(this.$refs.param.$el.offsetTop);\r\n      this.themeTops.push(this.$refs.comment.$el.offsetTop);\r\n      this.themeTops.push(this.$refs.recommend.$el.offsetTop);\r\n      this.themeTops.push(Number.MAX_VALUE);\r\n    },\r\n    contentScroll(position) {\r\n      // 1.监听backTop的显示\r\n      this.showBackTop = position.y < -BACKTOP_DISTANCE;\r\n\r\n      // 2.监听滚动到哪一个主题\r\n      this._listenScrollTheme(-position.y);\r\n    },\r\n    _listenScrollTheme(position) {\r\n      let length = this.themeTops.length;\r\n      for (let i = 0; i < length; i++) {\r\n        let iPos = this.themeTops[i];\r\n        /**\r\n         * 判断的方案:\r\n         *  方案一:\r\n         *    条件: (i < (length-1) && currentPos >= iPos && currentPos < this.themeTops[i+1]) || (i === (length-1) && currentPos >= iPos),\r\n         *    优点: 不需要引入其他的内容, 通过逻辑解决\r\n         *    缺点: 判断条件过长, 并且不容易理解\r\n         *  方案二:\r\n         *    条件: 给themeTops最后添加一个很大的值, 用于和最后一个主题的top进行比较.\r\n         *    优点: 简洁明了, 便于理解\r\n         *    缺点: 需要引入一个较大的int数字\r\n         * 疑惑: 在第一个判断中, 为什么不能直接判断(currentPos >= iPos)即可?\r\n         * 解答: 比如在某一个currentPos大于第0个时, 就会break, 不会判断后面的i了.\r\n         */\r\n        if (position >= iPos && position < this.themeTops[i + 1]) {\r\n          if (this.currentIndex !== i) {\r\n            this.currentIndex = i;\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    titleClick(index) {\r\n      console.log(this.themeTops[index]);\r\n      this.$refs.scroll.scrollTo(0, -this.themeTops[index], 100);\r\n    },\r\n    addToCart() {\r\n      // 1.创建对象\r\n      const obj = {};\r\n      // 2.对象信息\r\n      obj.iid = this.iid;\r\n      obj.imgURL = this.topImages[0];\r\n      obj.title = this.goods.title;\r\n      obj.desc = this.goods.desc;\r\n      obj.newPrice = this.goods.nowPrice;\r\n      // 3.1用mapAction映射添加到Store中\r\n      this.addCart(obj).then(res=>{\r\n        this.$toast.show(res)\r\n      })\r\n      //3.2用dispatc添加到Store中\r\n      // this.$store.dispatch(\"addCart\", obj).then(res=>{\r\n      //   console.log(res)\r\n      // });\r\n      //4.添加到购物车成功\r\n    },\r\n    _getDetailData() {\r\n      // 1.获取iid\r\n      const iid = this.$route.query.iid;\r\n      this.iid = iid;\r\n\r\n      // 2.请求数据\r\n      getDetail(iid).then(res => {\r\n        // 2.1.获取结果\r\n        const data = res.result;\r\n\r\n        // 2.2.获取顶部信息\r\n        this.topImages = data.itemInfo.topImages;\r\n\r\n        // 2.3.获取商品信息\r\n        this.goods = new Goods(\r\n          data.itemInfo,\r\n          data.columns,\r\n          data.shopInfo.services\r\n        );\r\n\r\n        // 2.4.获取店铺信息\r\n        this.shop = new Shop(data.shopInfo);\r\n\r\n        // 2.5.获取商品信息\r\n        this.detailInfo = data.detailInfo;\r\n\r\n        // 2.6.保存参数信息\r\n        this.paramInfo = new GoodsParam(\r\n          data.itemParams.info,\r\n          data.itemParams.rule\r\n        );\r\n\r\n        // 2.7.保存评论信息\r\n        if (data.rate.list) {\r\n          this.commentInfo = data.rate.list[0];\r\n        }\r\n      });\r\n    },\r\n    _getRecommend() {\r\n      getRecommend().then((res, error) => {\r\n        if (error) return;\r\n        this.recommendList = res.data.list;\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n#detail {\r\n  height: 100vh;\r\n  position: relative;\r\n  z-index: 1;\r\n  background-color: #fff;\r\n}\r\n\r\n.content {\r\n  position: absolute;\r\n  top: 44px;\r\n  bottom: 60px;\r\n}\r\n\r\n.back-top {\r\n  position: fixed;\r\n  right: 10px;\r\n  bottom: 65px;\r\n}\r\n</style>\r\n"],"sourceRoot":"src\\views\\detail"}]}